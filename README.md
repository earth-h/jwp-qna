# JPA

## 1단계 - 엔티티 매핑
### 요구 사항
1. 주어진 DDL을 보고 entity 클래스와 리포지토리 클래스 작성
2. @DataJpaTest를 활용하여 테스트 진행

### 테이블 정의
* 아래 DDL(Data Definition Language)을 보고 유추하여 작성
```sql
create table answer
(
    id          bigint generated by default as identity,
    contents    clob,
    created_at  timestamp not null,
    deleted     boolean   not null,
    question_id bigint,
    updated_at  timestamp,
    writer_id   bigint,
    primary key (id)
)
```
```sql
create table delete_history
(
    id            bigint generated by default as identity,
    content_id    bigint,
    content_type  varchar(255),
    create_date   timestamp,
    deleted_by_id bigint,
    primary key (id)
)
```
```sql
create table question
(
    id         bigint generated by default as identity,
    contents   clob,
    created_at timestamp    not null,
    deleted    boolean      not null,
    title      varchar(100) not null,
    updated_at timestamp,
    writer_id  bigint,
    primary key (id)
)
```
```sql
create table user
(
    id         bigint generated by default as identity,
    created_at timestamp   not null,
    email      varchar(50),
    name       varchar(20) not null,
    password   varchar(20) not null,
    updated_at timestamp,
    user_id    varchar(20) not null,
    primary key (id)
)

alter table user
    add constraint UK_a3imlf41l37utmxiquukk8ajc unique (user_id)
```
#### answer
| 컬럼명         | PK 여부 | 타입        | 비고                               |
|-------------|-------|-----------|----------------------------------|
| id          | O     | bigint    | generated by default as identity |
| contents    |   | clob      |                                  |
| created_at  |  | timestamp | not null                         |
| deleted     |  | boolean   | not null                         |
| question_id |  | bigint    |                                  |
| updated_at  |  | timestamp |                                  |
| writer_id   |  | bigint    |                                  |

#### deleted_history
| 컬럼명          | PK 여부 | 타입           | 비고                               |
|--------------|-------|--------------|----------------------------------|
| id           | O     | bigint       | generated by default as identity |
| content_id   |   | bigint       |                                  |
| content_type |  | varchar(255) |                                  |
| create_date  |  | timestamp    |                          |
| deleted_by_id |  | bigint       |                                  |

#### question
| 컬럼명        | PK 여부 | 타입           | 비고                               |
|------------|-------|--------------|----------------------------------|
| id         | O     | bigint       | generated by default as identity |
| contents   |   | clob         |                                  |
| created_at |  | timestamp    | not null                         |
| deleted    |  | boolean      | not null                         |
| title         |  | varchar(100) | not null                         |
| updated_at |  | timestamp    |                                  |
| writer_id   |  | bigint    |                                  |

#### user
| 컬럼명        | PK 여부 | 타입          | 비고                                       |
|------------|-------|-------------|------------------------------------------|
| id         | O     | bigint      | generated by default as identity |
| created_at |  | timestamp   | not null                                 |
| email      |  | varchar(50) |                                          |
| name       |  | varchar(20) | not null                                 |
| password   |  | varchar(20) | not null                                 |
| updated_at |  | timestamp   |                                          |
| user_id    |  | varchar(20) | not null                                 |
* user_id는 unique해야 함

### application.yml 추가 사항
```yml
spring:
  datasource:
    url: jdbc:h2:~/test;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
    username: sa
    driver-class-name: org.h2.Driver

  h2:
    console:
      enabled: true

  jpa:
    properties:
      hibernate:
        format_sql: true
    hibernate:
      ddl-auto: create-drop
    show-sql: true
```
* H2 콘솔에 접근할 수도 있다고 생각해 콘솔 설정 진행
* application 실행 시마다 기존 테이블 삭제되고 생성되도록 ddl-auto를 create-drop으로 설정

### 테스트 목록
1. [x] Answer 등록/조회/삭제 테스트
2. [x] Answer 객체 생성 시 예외처리 테스트
3. [x] Question 등록/조회/삭제 테스트
4. [x] Question 객체 생성 시 예외처리 테스트
5. [x] User 등록/조회/삭제 테스트
7. [x] DeleteHistory 등록/조회/삭제 테스트